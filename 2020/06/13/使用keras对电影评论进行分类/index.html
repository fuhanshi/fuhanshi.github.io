<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.2" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.2">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.2" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.4.2',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="加载IMDB数据集1from tensorflow.keras.datasets import imdb 1(train_data,train_labels),(test_data,test_labels)=imdb.load_data(num_words=10000) 1train_data.shape (25000,) 1train_data[0] [1,  14,  22,  16,  43">
<meta name="keywords" content="Share">
<meta property="og:type" content="article">
<meta property="og:title" content="使用keras对电影评论进行分类">
<meta property="og:url" content="http://yoursite.com/2020/06/13/使用keras对电影评论进行分类/index.html">
<meta property="og:site_name" content="一个大学狗的日常">
<meta property="og:description" content="加载IMDB数据集1from tensorflow.keras.datasets import imdb 1(train_data,train_labels),(test_data,test_labels)=imdb.load_data(num_words=10000) 1train_data.shape (25000,) 1train_data[0] [1,  14,  22,  16,  43">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2020/06/13/使用keras对电影评论进行分类/output_25_0.png">
<meta property="og:image" content="http://yoursite.com/2020/06/13/使用keras对电影评论进行分类/output_26_0.png">
<meta property="og:updated_time" content="2020-06-13T06:33:44.636Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用keras对电影评论进行分类">
<meta name="twitter:description" content="加载IMDB数据集1from tensorflow.keras.datasets import imdb 1(train_data,train_labels),(test_data,test_labels)=imdb.load_data(num_words=10000) 1train_data.shape (25000,) 1train_data[0] [1,  14,  22,  16,  43">
<meta name="twitter:image" content="http://yoursite.com/2020/06/13/使用keras对电影评论进行分类/output_25_0.png">



  <link rel="alternate" href="/atom.xml" title="一个大学狗的日常" type="application/atom+xml" />




  <link rel="canonical" href="http://yoursite.com/2020/06/13/使用keras对电影评论进行分类/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>使用keras对电影评论进行分类 | 一个大学狗的日常</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">一个大学狗的日常</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">放弃不难，但坚持一定很酷</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-主页">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />主页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-关于">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-标签">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-分类">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-时间轴">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />时间轴</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/13/使用keras对电影评论进行分类/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="凡希">
      <meta itemprop="description" content="大学狗的日常">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一个大学狗的日常">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">使用keras对电影评论进行分类
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-06-13 14:30:28 / 修改时间：14:33:44" itemprop="dateCreated datePublished" datetime="2020-06-13T14:30:28+08:00">2020-06-13</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/keras/" itemprop="url" rel="index"><span itemprop="name">keras</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon"
            >
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="加载IMDB数据集"><a href="#加载IMDB数据集" class="headerlink" title="加载IMDB数据集"></a>加载IMDB数据集</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.datasets <span class="keyword">import</span> imdb</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(train_data,train_labels),(test_data,test_labels)=imdb.load_data(num_words=<span class="number">10000</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_data.shape</span><br></pre></td></tr></table></figure>
<pre><code>(25000,)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_data[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<pre><code>[1,
 14,
 22,
 16,
 43,
 ...
 ...
 ...
 178,
 32]
</code></pre><p>train_data中的每一项都是这样的一个列表，代表的单词对应的下标索引，每一个数字都对应一个单词</p>
<p>下面这一段代码可以将某条评论解码为英文单词</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#word_index是一个将单词映射为整数的字典</span></span><br><span class="line">word_index=imdb.get_word_index()</span><br><span class="line"><span class="comment">#reverse_word_index ：整数-&gt;单词</span></span><br><span class="line">reverse_word_index=dict(</span><br><span class="line">    [(value,key) <span class="keyword">for</span> (key,value) <span class="keyword">in</span> word_index.items()]</span><br><span class="line">    )</span><br><span class="line"><span class="comment">#注意，索引减去了 3，因为 0、 1、 2</span></span><br><span class="line"><span class="comment">#是为“padding”（填充）、“start of sequence”（序</span></span><br><span class="line"><span class="comment">#列开始）、“unknown”（未知词）分别保留的索引</span></span><br><span class="line">decoded_review=<span class="string">' '</span>.join(</span><br><span class="line">[reverse_word_index.get(i<span class="number">-3</span>,<span class="string">'?'</span>) <span class="keyword">for</span> i <span class="keyword">in</span> train_data[<span class="number">0</span>]])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">decoded_review</span><br></pre></td></tr></table></figure>
<pre><code>&quot;? this film was just brilliant casting location scenery story direction everyone&apos;s really suited the part they played and you could just imagine being there robert ? is an amazing actor and now the same being director ? father came from the same scottish island as myself so i loved the fact there was a real connection with this film the witty remarks throughout the film were great it was just brilliant so much that i bought the film as soon as it was released for ? and would recommend it to everyone to watch and the fly fishing was amazing really cried at the end it was so sad and you know what they say if you cry at a film it must have been good and this definitely was also ? to the two little boy&apos;s that played the ? of norman and paul they were just brilliant children are often left out of the ? list i think because the stars that play them all grown up are such a big profile for the whole film but these children are amazing and should be praised for what they have done don&apos;t you think the whole story was so lovely because it was true and was someone&apos;s life after all that was shared with us all&quot;
</code></pre><h2 id="将整数序列编码为二进制矩阵（one-hot编码）"><a href="#将整数序列编码为二进制矩阵（one-hot编码）" class="headerlink" title="将整数序列编码为二进制矩阵（one-hot编码）"></a>将整数序列编码为二进制矩阵（one-hot编码）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vectorize_sequences</span><span class="params">(sequences,dimension=<span class="number">10000</span>)</span>:</span></span><br><span class="line">    <span class="comment">#创建一个size为（len(sequences),dimension）的</span></span><br><span class="line">    <span class="comment">#全零矩阵results</span></span><br><span class="line">    results=np.zeros((len(sequences),dimension))</span><br><span class="line">    <span class="keyword">for</span> i ,sequence <span class="keyword">in</span> enumerate(sequences):</span><br><span class="line">        results[i,sequence]=<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"><span class="comment">#ps:感觉这里的行列些反了，不过没关系</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#have a try</span></span><br><span class="line">vectorize_sequences(train_data[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<pre><code>array([[0., 1., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       ...,
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.],
       [0., 0., 0., ..., 0., 0., 0.]])
</code></pre><p>记得我们的train_data[0]的第一个元素是1，所以第一行中下标为1的地方是1，其余为0.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#现在将训练数据和测试数据向量化</span></span><br><span class="line">x_train=vectorize_sequences(train_data)</span><br><span class="line">x_test=vectorize_sequences(test_data)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x_train.shape</span><br></pre></td></tr></table></figure>
<pre><code>(25000, 10000)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将标签向量化</span></span><br><span class="line">y_train=np.asarray(train_labels).astype(<span class="string">'float32'</span>)</span><br><span class="line">y_test=np.asarray(test_labels).astype(<span class="string">'float32'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="构建网络"><a href="#构建网络" class="headerlink" title="构建网络"></a>构建网络</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#模型定义</span></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> models,layers</span><br><span class="line">model=models.Sequential()</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>,activation=<span class="string">'relu'</span>,input_shape=(<span class="number">10000</span>,)))</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>,activation=<span class="string">'relu'</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>,activation=<span class="string">'sigmoid'</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编译模型</span></span><br><span class="line">model.compile(optimizer=<span class="string">'rmsprop'</span>,</span><br><span class="line">             loss=<span class="string">'binary_crossentropy'</span>,</span><br><span class="line">             metrics=[<span class="string">'accuracy'</span>])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置优化器</span></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> optimizers</span><br><span class="line">model.compile(optimizer=optimizers.RMSprop(lr=<span class="number">0.001</span>),</span><br><span class="line">             loss=<span class="string">'binary_crossentropy'</span>,</span><br><span class="line">             metrics=[<span class="string">'accuracy'</span>])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用自定义的损失和指标</span></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> losses,metrics</span><br><span class="line">model.compile(optimizer=optimizers.RMSprop(lr=<span class="number">0.001</span>),</span><br><span class="line">             loss=losses.binary_crossentropy,</span><br><span class="line">             metrics=[metrics.binary_accuracy])</span><br></pre></td></tr></table></figure>
<h2 id="训练模型-验证模型"><a href="#训练模型-验证模型" class="headerlink" title="训练模型+验证模型"></a>训练模型+验证模型</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#留出验证集</span></span><br><span class="line">x_val=x_train[:<span class="number">10000</span>]</span><br><span class="line">partial_x_train=x_train[<span class="number">10000</span>:]</span><br><span class="line"></span><br><span class="line">y_val=y_train[:<span class="number">10000</span>]</span><br><span class="line">partial_y_train=y_train[<span class="number">10000</span>:]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#训练模型并同时在验证集上做验证</span></span><br><span class="line">model.compile(optimizer=<span class="string">'rmsprop'</span>,</span><br><span class="line">             loss=<span class="string">'binary_crossentropy'</span>,</span><br><span class="line">             metrics=[<span class="string">'acc'</span>])</span><br><span class="line"></span><br><span class="line">history=model.fit(partial_x_train,</span><br><span class="line">                 partial_y_train,</span><br><span class="line">                 epochs=<span class="number">20</span>,</span><br><span class="line">                 batch_size=<span class="number">512</span>,</span><br><span class="line">                 validation_data=(x_val,y_val))</span><br></pre></td></tr></table></figure>
<pre><code>Epoch 1/20
30/30 [==============================] - 1s 29ms/step - loss: 0.0046 - acc: 0.9989 - val_loss: 1.3084 - val_acc: 0.8560
Epoch 2/20
30/30 [==============================] - 1s 24ms/step - loss: 8.3249e-05 - acc: 1.0000 - val_loss: 1.3129 - val_acc: 0.8571
Epoch 3/20
30/30 [==============================] - 1s 25ms/step - loss: 6.5058e-05 - acc: 1.0000 - val_loss: 1.3250 - val_acc: 0.8568
Epoch 4/20
30/30 [==============================] - 1s 24ms/step - loss: 5.2597e-05 - acc: 1.0000 - val_loss: 1.3834 - val_acc: 0.8561
Epoch 5/20
30/30 [==============================] - 1s 26ms/step - loss: 7.6493e-04 - acc: 0.9998 - val_loss: 1.4176 - val_acc: 0.8562
Epoch 6/20
30/30 [==============================] - 1s 26ms/step - loss: 3.2046e-05 - acc: 1.0000 - val_loss: 1.4258 - val_acc: 0.8561
Epoch 7/20
30/30 [==============================] - 1s 31ms/step - loss: 2.9245e-05 - acc: 1.0000 - val_loss: 1.4446 - val_acc: 0.8557
Epoch 8/20
30/30 [==============================] - 1s 26ms/step - loss: 2.5217e-05 - acc: 1.0000 - val_loss: 1.4725 - val_acc: 0.8563
Epoch 9/20
30/30 [==============================] - 1s 26ms/step - loss: 0.0011 - acc: 0.9996 - val_loss: 1.5182 - val_acc: 0.8561
Epoch 10/20
30/30 [==============================] - 1s 26ms/step - loss: 1.5805e-05 - acc: 1.0000 - val_loss: 1.5262 - val_acc: 0.8555
Epoch 11/20
30/30 [==============================] - 1s 24ms/step - loss: 1.4758e-05 - acc: 1.0000 - val_loss: 1.5354 - val_acc: 0.8553
Epoch 12/20
30/30 [==============================] - 1s 24ms/step - loss: 1.3594e-05 - acc: 1.0000 - val_loss: 1.5507 - val_acc: 0.8546
Epoch 13/20
30/30 [==============================] - 1s 25ms/step - loss: 1.1385e-05 - acc: 1.0000 - val_loss: 1.5909 - val_acc: 0.8551
Epoch 14/20
30/30 [==============================] - 1s 25ms/step - loss: 8.7676e-04 - acc: 0.9997 - val_loss: 1.6677 - val_acc: 0.8538
Epoch 15/20
30/30 [==============================] - 1s 24ms/step - loss: 1.1577e-05 - acc: 1.0000 - val_loss: 1.6620 - val_acc: 0.8560
Epoch 16/20
30/30 [==============================] - 1s 36ms/step - loss: 8.7293e-06 - acc: 1.0000 - val_loss: 1.6632 - val_acc: 0.8555
Epoch 17/20
30/30 [==============================] - 1s 27ms/step - loss: 7.2850e-06 - acc: 1.0000 - val_loss: 1.6734 - val_acc: 0.8555
Epoch 18/20
30/30 [==============================] - 1s 26ms/step - loss: 6.0855e-06 - acc: 1.0000 - val_loss: 1.7012 - val_acc: 0.8552
Epoch 19/20
30/30 [==============================] - 1s 24ms/step - loss: 1.4016e-04 - acc: 0.9999 - val_loss: 1.7631 - val_acc: 0.8541
Epoch 20/20
30/30 [==============================] - 1s 24ms/step - loss: 4.7701e-06 - acc: 1.0000 - val_loss: 1.7625 - val_acc: 0.8558
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#绘制训练损失和验证损失</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">history_dict=history.history</span><br><span class="line"><span class="comment">#print(history_dict.keys())#dict_keys(['loss', 'acc', 'val_loss', 'val_acc'])</span></span><br><span class="line">loss_values=history_dict[<span class="string">'loss'</span>]</span><br><span class="line">val_loss_values=history_dict[<span class="string">'val_loss'</span>]</span><br><span class="line"></span><br><span class="line">epochs=range(<span class="number">1</span>,len(loss_values)+<span class="number">1</span>)<span class="comment">#训练的轮次</span></span><br><span class="line"></span><br><span class="line">plt.plot(epochs,loss_values,<span class="string">'bo'</span>,label=<span class="string">'Training loss'</span>)</span><br><span class="line">plt.plot(epochs,val_loss_values,<span class="string">'b'</span>,label=<span class="string">'Validation loss'</span>)</span><br><span class="line">plt.title(<span class="string">'Training and validation loss'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Epochs'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Loss'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="output_25_0.png" alt="1.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#绘制训练精度和验证精度</span></span><br><span class="line">plt.clf()</span><br><span class="line">acc=history_dict[<span class="string">'acc'</span>]</span><br><span class="line">val_acc=history_dict[<span class="string">'val_acc'</span>]</span><br><span class="line"></span><br><span class="line">plt.plot(epochs,acc,<span class="string">'bo'</span>,label=<span class="string">'Training acc'</span>)</span><br><span class="line">plt.plot(epochs,val_acc,<span class="string">'b'</span>,label=<span class="string">'Validation acc'</span>)</span><br><span class="line">plt.title(<span class="string">'Training and validation accuracy'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Epochs'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Accuracy'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="output_26_0.png" alt="2.png"></p>
<p>过拟合了！</p>
<p>观察loss图像，发现epochs为4时loss最小，所以接下来重新训练模型，设置epoch为4</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#尝试重新训练一个模型</span></span><br><span class="line">model=models.Sequential()</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>,activation=<span class="string">'relu'</span>,input_shape=(<span class="number">10000</span>,)))</span><br><span class="line">model.add(layers.Dense(<span class="number">16</span>,activation=<span class="string">'relu'</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">1</span>,activation=<span class="string">'sigmoid'</span>))</span><br><span class="line"></span><br><span class="line">model.compile(optimizer=<span class="string">'rmsprop'</span>,</span><br><span class="line">             loss=<span class="string">'binary_crossentropy'</span>,</span><br><span class="line">             metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line">model.fit(x_train,y_train,epochs=<span class="number">4</span>,batch_size=<span class="number">512</span>)</span><br><span class="line">results=model.evaluate(x_test,y_test)</span><br></pre></td></tr></table></figure>
<pre><code>Epoch 1/4
49/49 [==============================] - 1s 13ms/step - loss: 0.4649 - accuracy: 0.8296
Epoch 2/4
49/49 [==============================] - 1s 14ms/step - loss: 0.2706 - accuracy: 0.9058
Epoch 3/4
49/49 [==============================] - 1s 13ms/step - loss: 0.2064 - accuracy: 0.9260
Epoch 4/4
49/49 [==============================] - 1s 13ms/step - loss: 0.1738 - accuracy: 0.9366
782/782 [==============================] - 1s 2ms/step - loss: 0.2923 - accuracy: 0.8841
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">results</span><br></pre></td></tr></table></figure>
<pre><code>[0.29230669140815735, 0.8840799927711487]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#预测</span></span><br><span class="line">model.predict(x_test)</span><br></pre></td></tr></table></figure>
<pre><code>array([[0.16965643],
       [0.99986595],
       [0.86651677],
       ...,
       [0.101327  ],
       [0.05761746],
       [0.545027  ]], dtype=float32)
</code></pre>
      
    </div>

    

    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/uploads/wechat-qcode.jpg" alt="凡希 wechat" style="width: 200px; max-width: 100%;"/>
    <div>喜欢所以热爱，坚持干货分享，欢迎订阅我的微信公众号</div>
</div>

      </div>
    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>呐，请我吃辣条</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="凡希 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="凡希 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/05/28/Python基础第一部分/" rel="next" title="Python基础第一部分">
                <i class="fa fa-chevron-left"></i> Python基础第一部分
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/06/13/Python基础第二部分/" rel="prev" title="Python基础第二部分">
                Python基础第二部分 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">凡希</p>
              <p class="site-description motion-element" itemprop="description">大学狗的日常</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">124</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">17</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#加载IMDB数据集"><span class="nav-number">1.</span> <span class="nav-text">加载IMDB数据集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#将整数序列编码为二进制矩阵（one-hot编码）"><span class="nav-number">2.</span> <span class="nav-text">将整数序列编码为二进制矩阵（one-hot编码）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#构建网络"><span class="nav-number">3.</span> <span class="nav-text">构建网络</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#训练模型-验证模型"><span class="nav-number">4.</span> <span class="nav-text">训练模型+验证模型</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">凡希</span>

  

  
</div>










  <div class="footer-custom">微信公众号：我将在南极找寻你</div>





        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  













  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.2"></script>



  



  










  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  

  


  
  

  

  

  

  

  



<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script
</body>
</html>



